{% extends 'supernova/base.html' %}

{% load static %}

{% block head %}
  <link rel="stylesheet" type="text/css" href="{% static 'css/balloon.min.css' %}"/>
{% endblock %}

{% block content_wrapper %}
  <div class="col profile">
    <div class="header-decorator">
      <div class="header-decorator-options">
        <ul>
          {% if request.user == profile_user or request.user.is_staff %}
            {% if perms.users.add_invite %}
              <li><a href="{% url 'users:invites' profile_user.nickname %}">Convites</a></li>
            {% endif %}
            <li><a href="{% url 'users:settings' profile_user.nickname %}">Definições</a></li>
          {% endif %}
        </ul>
      </div>
      <h1>
        <img class="highres" src="{% if profile_user.picture %}{{ profile_user.picture.url }}{% else %}{% static 'img/user.svg' %}{% endif %}">
        {% if profile_user.get_full_name %}{{ profile_user.get_full_name }}{% else %}{{ profile_user.nickname }}{% endif %}
      </h1>
    </div>
    <div class="row padded nowrap">
      <div class="col nogrow" style="flex-basis: 400px">
        {% if permissions.info_visibility %}
          <div class="flex-pane">
            <div class="pane-title bg-grad"><h2>Informação</h2></div>
            <div class="pane-content">
              <div class="students">
                {% for student in primary_students %}
                  <div>
                    <b>CLIP ID: </b>{{ student.abbreviation }}<br>
                    <b>Numero: </b>{{ student.number }}<br>
                    {% if student.year %}
                      <b>Ano:</b> <span>{{ student.year }}º</span>
                      <br>
                    {% endif %}
                    {% if student.avg_grade %}
                      <b>Média:</b>
                      <span>{{ student.avg_grade|floatformat }}</span>
                      <a><sup aria-label="Em {{ student.ects }} ECTS conhecidos. Sem melhorias." data-balloon-pos="down">*</sup></a>
                      <br>
                    {% endif %}
                    {% if student.course %}
                      <b>Curso: </b>
                      <a href="{% url 'college:course' student.course.id %}">{{ student.course.abbreviation }}</a>
                    {% else %}
                      Desconhecido
                    {% endif %}
                  </div>
                {% endfor %}
                {% for student in secondary_students %}
                  {% if student != primary_student %}
                    <div>
                      <b>Numero: </b>{{ student.number }}<br>
                      {% if student.avg_grade %}
                        <b>Média:</b>
                        <a><sup aria-label="Em {{ student.ects }} ECTS conhecidos. Sem melhorias." data-balloon-pos="down">*</sup></a>
                        <br>
                      {% endif %}
                      {% if student.course %}
                        <b>Curso: </b>
                        <a href="{% url 'college:course' student.course.id %}">
                          {{ student.course.abbreviation }}
                        </a>
                      {% endif %}
                    </div>
                  {% endif %}
                {% endfor %}
              </div>
              {% if profile_user.residence %}
                <h4>Zona de residência:</h4>
                <span class="indented">{{ profile_user.residence }}</span>
              {% endif %}
              <h4>Utilizador desde:</h4>
              <span class="indented">{{ profile_user.date_joined }}</span>
              <h4>Última atividade:</h4>
              <span class="indented">{{ profile_user.last_activity }}</span>
              {% if profile_user.webpage %}
                <h4>Página:</h4>
                <a class="indented" href="{{ profile_user.webpage }}">{{ profile_user.webpage }}</a>
              {% endif %}
            </div>
          </div>
        {% endif %}
        {% if permissions.about_visibility and profile_user.bio %}
          <div class="flex-pane">
            <div class="pane-title bg-grad"><h2>Sobre mim</h2></div>
            <div class="pane-content">
              {{ profile_user.bio_html | safe }}
            </div>
          </div>
        {% endif %}
        {% if profile_user.badges.exists %}
          <div class="flex-pane">
            <div class="pane-title bg-grad">
              <h2>Conquistas</h2>
            </div>
            <div class="pane-content">
              <ul>
                {% for badge in profile_user.badges.all %}
                  <span class="archievement {{ badge.style }}">{{ badge.name }}</span>
                {% endfor %}
              </ul>
            </div>
          </div>
        {% endif %}
        {% if permissions.social_visibility and profile_user.social_networks.exists %}
          <div class="flex-pane">
            <div class="pane-title bg-grad">
              <h2>Perfis</h2>
            </div>
            <div class="pane-content">
              <ul id="social-network-list" class="menu">
                {% for social_network in profile_user.social_networks.all %}
                  <li><a href="{{ social_network.profile }} ">{{ social_network.network_str }}</a></li>
                {% endfor %}
              </ul>
            </div>
          </div>
        {% endif %}
        {% if permissions.groups_visibility and profile_user.groups_custom.exists %}
          <div class="flex-pane">
            <div class="pane-title bg-grad"><h2>Grupos</h2></div>
            <div class="pane-content">
              {% for group in profile_user.groups_custom.all %}
                <a href="{% url 'groups:group' group.abbreviation %}">
                <span class="group" style="background-image: url({% get_media_prefix %}{{ group.image }}">
                  {{ group.abbreviation }}
                </span>
                </a>
              {% endfor %}
            </div>
          </div>
        {% endif %}
      </div>
      <div class="col">
        <div class="row">
          <div class="col">
            {% if permissions.schedule_visibility %}
              <div class="flex-pane">
                <div class="pane-title bg-grad">
                  <h2>Horário</h2>
                </div>
                <div class="pane-content">
                  {% if schedule %}
                    {% include 'college/schedule.html' %}
                  {% else %}
                    O teu horário encontra-se vazio. A aparição de inscrições recentes pode levar até 48 horas.
                  {% endif %}
                </div>
              </div>
            {% endif %}
          </div>
          <div class="col" style="flex-basis: 350px">
            {% if permissions.enrollments_visibility and current_class_instances.exists %}
              <div class="flex-pane">
                <div class="pane-title bg-grad">
                  <h2>Inscrições atuais</h2>
                </div>
                <div class="pane-content">
                  <ul class="menu">
                    {% for instance in current_class_instances %}
                      <li><a href="{% url 'college:class_instance' instance.id %}">{{ instance.parent.name }}</a></li>
                    {% endfor %}
                  </ul>
                </div>
              </div>
            {% endif %}
            {% if permissions.enrollments_visibility and past_classes.exists %}
              <div class="flex-pane">
                <div class="pane-title bg-grad">
                  <h2>Inscrições prévias</h2>
                </div>
                <div class="pane-content">
                  <ul class="menu">
                    {% for class in past_classes %}
                      <li><a href="{% url 'college:class' class.id %}">{{ class.name }}</a></li>
                    {% endfor %}
                  </ul>
                </div>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    {% if request.user.is_staff %}
      <div class="flex-pane">
        <div class="pane-title bg-grad">
          <h2>Debug</h2>
        </div>
        <div class="pane-content">
          <h3>Perms</h3>
          <span class="indented"><b>Is staff?</b> {{ profile_user.is_staff }}</span>
          <span class="indented"><b>Is student?</b> {{ profile_user.is_student }}</span>
          <span class="indented"><b>Is teacher?</b> {{ profile_user.is_teacher }}</span>
          <ul>
            {% for perm in profile_user.user_permissions.all %}
              <li>{{ perm }}</li>
            {% endfor %}
          </ul>
          <h3>Attributes</h3>
          <span class="indented"><b>Points</b> {{ profile_user.points }}</span>
        </div>
      </div>
    {% endif %}
  </div>
{% endblock %}