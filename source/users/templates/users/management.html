{% extends 'supernova/base.html' %}

{% load static %}

{% block head %}
  <script src="{% static  'users/management.js' %}"></script>
  <link href="{% static  'vendor/select2/dist/css/select2.min.css' %}" type="text/css" media="screen" rel="stylesheet">
  <link href="{% static  'admin/css/autocomplete.css' %}" type="text/css" media="screen" rel="stylesheet">
  <link href="{% static  'autocomplete_light/select2.css' %}" type="text/css" media="screen" rel="stylesheet">
  <script src="{% static  'admin/js/vendor/jquery/jquery.min.js' %}"></script>
  <script src="{% static  'autocomplete_light/jquery.init.js' %}"></script>
  <script src="{% static  'vendor/select2/dist/js/select2.full.min.js' %}"></script>
  <script src="{% static  'vendor/select2/dist/js/i18n/pt.js' %}"></script>
  <script src="{% static  'autocomplete_light/autocomplete.init.js' %}"></script>
  <script src="{% static  'autocomplete_light/forward.js' %}"></script>
  <script src="{% static  'autocomplete_light/select2.js' %}"></script>
  <script src="{% static  'autocomplete_light/jquery.post-setup.js' %}"></script>
{% endblock %}

{% block content_wrapper %}
  {% csrf_token %}
  <div class="row padded">
    <div class="col">
      <div class="flex-pane">
        <div class="pane-title bg-grad"><h2>Últimos registos</h2></div>
        <div class="pane-content">
          <table>
            <tr>
              <th>Username</th>
              <th>Alcunha</th>
              <th>Estudante</th>
              <th>Email</th>
              <th>Fracassos</th>
              <th>Convidante</th>
            </tr>
            {% for registration in latest_registrations %}
              <tr>
                <td>{{ registration.username }}</td>
                <td>{{ registration.nickname }}</td>
                <td>{{ registration.student }}</td>
                <td>{{ registration.email }}</td>
                <td>{{ registration.failed_attempts }}</td>
                {% with registration.invites.first as invite %}
                  {% if invite %}
                    <td><a href="{% url 'users:profile' invite.issuer.nickname %}">{{ invite.issuer.nickname }}</a></td>
                  {% else %}
                    <td>-</td>
                  {% endif %}
                {% endwith %}
              </tr>
            {% endfor %}
          </table>
        </div>
      </div>
    </div>
    <div class="col">
      <div class="flex-pane">
        <div class="pane-title bg-grad"><h2>Actividade</h2></div>
        <div class="pane-content">
          <table>
            <tr>
              <th>Data</th>
              <th>Utilizador</th>
              <th>Descrição</th>
            </tr>
            {% for activity in latest_activity %}
              <tr>
                <td>{{ activity.timestamp|date:'d/m/Y H:i' }}</td>
                <td><a href="{% url 'users:profile' activity.user.nickname %}">{{ activity.user.nickname }}</a></td>
                <td>{{ activity|capfirst }}</td>
              </tr>
            {% endfor %}
          </table>
        </div>
      </div>
      <div class="flex-pane">
        <div class="pane-title bg-grad"><h2>Utilizadores suspensos</h2></div>
        <div class="pane-content" data-endpoint="{% url 'api:user_moderation' 0 %}">
          {% if suspended_users|length == 0 %}
            Sem utilizadores suspensos.
          {% else %}
            <table>
              <tr>
                <th>Utilizador</th>
                <th>Até</th>
                <th></th>
              </tr>
              {% for user in suspended_users %}
                <tr data-id="{{ user.id }}">
                  <td><a href="{% url 'users:profile' user.nickname %}">{{ user.nickname }}</a></td>
                  <td>-</td>
                  <td><a onclick="removeSuspension(this, {{ user.id }})">Anular</a></td>
                </tr>
              {% endfor %}
            </table>
          {% endif %}
          <h4>Suspender:</h4>
        <select name="section" required id="suspension-selector" data-autocomplete-light-url="/u/ac/nickname/"
                data-autocomplete-light-function="select2"></select>
        <input type="button" value="Confirmar" onclick="suspend()">
        </div>
      </div>
    </div>
  </div>
{% endblock %}